{% extends "admin/Common/iframe_common.html.twig" %}
{% block container %}
<body class="gray-bg">
    <div class="wrapper wrapper-content">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>站点列表</h5>
                    </div>
                    <div class="ibox-content container-fluid">
                    	<form action="{{base_url('admin/Site/emailTpl/1')}}">
	                        <div class="row col-md-12">
	                        	<div class="col-md-3 form-group">
	                        		<label for="search-username">标题/模板名称</label>
	                        		<input type="text" class="form-control" name="title" value="{{getArr.title}}">
	                        	</div>
	                            <div class="col-md-3 form-group">
	                            	<label for="null" class="center-block">&nbsp;</label>
	                            	<button type="submit" class="btn btn-primary" id="search-btn"><i class="fa fa-search"></i>&nbsp;查询</button>
	    							<button type="button" class="btn btn-primary add-emai-tpl"><i class="fa fa-plus"></i>&nbsp;新增模板
	    							</button>
	                            </div>
	                        </div>
                        </form>
                        <div class="table-responsive col-md-12">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>            
                                    	<th>id</th>                         
                                        <th>模板名称</th>
                                        <th>邮件标题</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for da in data %}
                                    <tr>
                                    	<td>
                                    		{{da.id}}
                                    	</td>
                                        <td>
	                                        {{da.tpl_name}}
                                        </td>
                                        <td>{{da.title}}</td>
                                        <td>
	                                        <a href="javascript:void(0)" class="btn btn-sm btn-primary edit-btn" data-id="{{da.id}}" title="编辑"><i class="fa fa-edit"></i></a>
                                            <a title="删除" data-id="{{da.id}}" class="btn btn-sm btn-danger delete-btn" href="javascript:void(0)"><i class="fa fa-trash"></i></a>
                                        </td>
                                    </tr>
                                 {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="fixed-table-pagination col-md-12">
                        	<div class="pull-left pagination-detail">
                        		<span class="pagination-info">共<strong>{{pager.total}}</strong>条记录&nbsp;<strong>{{pager.nowindex}}/{{pager.totalpage}}</strong>页</span>
                    		</div>
                            {% autoescape true %}  
                             {{pager.show(1)|raw }}
                            {% endautoescape %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
{% endblock %}
{% block script %}
<script>
	jQuery(document).ready(function($) {

        $(document).on('click','.add-emai-tpl',function(){
            var openLayer = layer.open({
              type: 2,
              closeBtn:1,
              title:'添加邮件模板',
              shadeClose: false, //开启遮罩关闭
              area: ['70%', '90%'],
              maxmin: true,
              content:'{{base_url("admin/Site/editEmailTpl")}}'
            });
            layer.full(openLayer)
        })

        $(document).on('click','.edit-btn',function(){
            var id = $(this).data('id')
            var openLayer = layer.open({
              type: 2,
              closeBtn:1,
              title:'编辑邮件模板',
              shadeClose: false, //开启遮罩关闭
              area: ['70%', '90%'],
              maxmin:true,
              content:'{{base_url("admin/Site/editEmailTpl")}}?id='+id,
            });
            layer.full(openLayer)
        })

        $(document).on('click','.delete-btn',function(e){
            var $this = $(this);
            var id = $this.data("id");
            layer.msg("确认删除该邮件模板？",{
                time:0,
                btn:['确认','取消'],
                yes:function(){
                    $.ajax({
                        url: '{{base_url("admin/Site/deleteTpl")}}',
                        type: 'POST',
                        dataType: 'json',
                        data: {'id': id},
                        timeout:4000,
                        beforeSend:function(){
                            layer.load(2);
                        }
                    })
                    .done(function(e) {
                        if (e.status!=1) {
                            common.ajaxError(e);
                            return false;
                        }
                        layer.closeAll();
                        window.location.reload();
                        parent.layer.msg(e.message,{
                            icon:1
                        });                

                    })
                    .fail(function(e) {
                        common.ajaxError(e)
                    })
                    .always(function() {
                        layer.closeAll('loading');
                    });
                    
                }
            })
        })


	});
</script>
{% endblock %}